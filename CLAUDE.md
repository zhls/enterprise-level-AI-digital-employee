# 健康咨询助手：智能健康顾问系统 - 开发文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 项目名称 | 健康咨询助手：智能健康顾问系统 |
| 赛道 | 智能健康咨询与数字人交互 |
| 方向 | 健康咨询助手：智能健康顾问系统 |
| 文档版本 | v1.2 |
| 创建日期 | 2025-12-29 |
| 最后更新 | 2026-01-09 |

---

## 目录

1. [项目进度](#项目进度)
2. [项目简介](#项目简介)
3. [技术栈](#技术栈)
4. [技术架构](#技术架构)
5. [目录结构](#目录结构)
6. [环境配置](#环境配置)
7. [核心功能实现](#核心功能实现)
8. [API接口文档](#api接口文档)

---

## 项目进度

### 已完成 ✅

| 任务 | 状态 | 说明 |
|------|------|------|
| 项目初始化 | ✅ | 前后端一体化架构搭建 |
| 基础配置文件 | ✅ | package.json, tsconfig.json, vite.config.ts |
| 密钥配置页面 | ✅ | ApiKeyConfig 组件（localStorage存储） |
| 数字人连接控制 | ✅ | avatarStore + AvatarController + AvatarContainer |
| 大屏布局设计 | ✅ | DashboardLayout（响应式全屏布局） |
| 智能对话功能 | ✅ | 流式对话 + 健康咨询响应 |
| 语音输入功能 | ✅ | Web Speech API 语音识别 |
| 数字人播报 | ✅ | 自动播报健康建议 |
| API接口开发 | ✅ | /api/chat/stream 健康咨询接口 |
| 前端对接API | ✅ | 完整的健康咨询流程 |
| 快捷问题功能 | ✅ | 常见健康问题快速访问 |
| 健康咨询系统 | ✅ | 基于AI的智能健康顾问 |

---

## 项目简介

### 项目描述

基于魔珐星云3D数字人技术，打造一个能够实时解答用户健康咨询问题的智能健康顾问系统。通过数字人配合语音交互，为用户提供专业、直观的健康建议和指导。

### 应用场景

- **健康咨询**：用户随时咨询健康问题，获取专业建议
- **医疗辅助**：作为医疗咨询的辅助工具，提供初步健康指导
- **健康管理**：帮助用户了解健康知识，养成良好的生活习惯
- **科普教育**：通过数字人生动讲解健康知识

### 核心功能

| 功能 | 描述 |
|------|------|
| **智能健康对话** | AI助手基于健康知识库回答用户问题 |
| **语音交互** | 支持语音提问和语音播报 |
| **3D数字人** | 魔珐星云3D数字人提供拟人化健康咨询服务 |
| **快捷问题** | 常见健康问题快速访问 |
| **健康监测** | 基于用户描述的健康状况提供分析 |
| **多视图切换** | 健康咨询、数字人展示等多种视图 |

### 技术亮点

- **AI驱动健康咨询**：使用魔搭社区大模型提供专业健康建议
- **双模态交互**：语音播报 + 文字对话 + 语音输入
- **流式响应**：对话采用SSE流式传输，响应更快速
- **大屏适配**：自动缩放适配不同屏幕尺寸
- **状态管理**：Zustand轻量级状态管理
- **语音识别**：集成Web Speech API实现语音输入

---

## 技术栈

### 前端技术栈

```yaml
框架: React 18.x + TypeScript
构建工具: Vite 5.x
状态管理: Zustand
样式方案: TailwindCSS
HTTP客户端: Axios
语音识别: Web Speech API
大屏适配: vw/vh 单位 + Scale缩放
```

### 后端技术栈

```yaml
运行环境: Node.js 18.x
框架: Express + TypeScript
AI服务: 魔搭社区 (ModelScope)
对话模型: deepseek-ai/DeepSeek-V3
数据处理:
  - 健康知识库整合
  - 流式对话生成
  - 健康建议分析
```

### 具身驱动SDK

```yaml
SDK名称: 魔珐星云具身驱动SDK
版本: 0.1.0-alpha.45
接入方式: JavaScript CDN
```

---

## 技术架构

### 系统架构图

```
┌────────────────────────────────────────────────────────────────────┐
│                          客户端层 (Browser)                         │
├────────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │
│  │  React UI    │  │  星云SDK层   │  │  状态管理    │             │
│  │              │  │              │  │  (Zustand)   │             │
│  │ - 健康咨询   │  │ - 3D数字人   │◄─┤              │             │
│  │ - 语音输入   │  │ - 语音合成   │  │ - 对话历史   │             │
│  │ - 播报控制   │  │ - 连接控制   │  │ - 密钥配置   │             │
│  │ - 快捷问题   │  │ - 状态监控   │  │              │             │
│  └──────────────┘  └──────────────┘  └──────────────┘             │
└────────────────────────────────────────────────────────────────────┘
                                  │
                                  │ HTTP/WebSocket
                                  ▼
┌────────────────────────────────────────────────────────────────────┐
│                          服务端层 (Node.js)                         │
├────────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │
│  │  API服务     │  │  AI服务      │  │  健康知识库   │             │
│  │  (Express)   │  │  (魔搭)      │  │              │             │
│  │              │  │              │  │              │             │
│  │ - /chat      │─►│ - 对话回复   │◄─│ - 健康知识   │             │
│  │              │  │ - 流式响应   │  │ - 专业建议   │             │
│  │              │  │ - 健康分析   │  │              │             │
│  └──────────────┘  └──────────────┘  └──────────────┘             │
└────────────────────────────────────────────────────────────────────┘
```

### 数据流图

```
用户输入健康问题
    │
    ▼
┌──────────────────┐
│  前端界面         │
│  (文字/语音输入)  │
└────┬─────────────┘
     │ 1. 发起健康咨询请求
     ▼
┌─────────────────────┐
│  后端API            │
│  /api/chat/stream   │
└────┬────────────────┘
     │ 2. 构建健康知识库提示词
     ▼
┌─────────────────────┐     ┌──────────────┐
│  魔搭AI             │────►│ 流式生成响应 │
│  DeepSeek-V3       │     │              │
└────┬────────────────┘     └──────────────┘
     │ 3. 返回健康建议
     ▼
┌─────────────────────┐
│  对话展示           │
│  - 健康建议内容     │
│  - 专业医疗指导     │
│  - 健康生活建议     │
└────┬────────────────┘
     │ 4. 数字人播报健康建议
     ▼
┌─────────────────────┐
│  数字人播报         │
│  自动语音播报健康建议│
└─────────────────────┘
```

---

## 目录结构

```
health-consultant/
├── src/                         # 源代码目录
│   ├── client/                  # 前端代码 (React + TypeScript)
│   │   ├── components/
│   │   │   ├── Avatar/          # 数字人组件
│   │   │   │   ├── AvatarController.ts      # SDK控制器
│   │   │   │   └── AvatarContainer.tsx      # 数字人容器
│   │   │   ├── Chat/            # 对话组件
│   │   │   │   └── ChatBox.tsx              # AI对话框
│   │   │   ├── Config/          # 配置组件
│   │   │   │   └── ApiKeyConfig.tsx         # 密钥配置页
│   │   │   └── Dashboard/       # 大屏组件
│   │   │       └── DashboardLayout.tsx      # 大屏布局
│   │   ├── store/                # 状态管理
│   │   │   ├── keyStore.ts        # 密钥状态
│   │   │   └── avatarStore.ts     # 数字人状态
│   │   ├── services/             # 服务层
│   │   │   ├── keyService.ts      # 密钥管理
│   │   │   └── dataService.ts     # 数据服务
│   │   └── App.tsx               # 主应用
│   │
│   ├── server/                   # 后端代码 (Node.js + TypeScript)
│   │   ├── routes/               # API路由
│   │   │   └── chat.routes.ts    # 对话路由
│   │   └── services/             # 业务服务
│   │       └── chatService.ts         # 对话服务
│   │
│   └── shared/                   # 共享代码
│       └── types/               # 共享类型定义
│
├── data/                        # 数据文件
│   └── mock/                    # 模拟健康数据
│
├── public/                      # 静态资源
├── package.json                 # 项目配置
├── vite.config.ts              # Vite配置
├── tsconfig.json               # TypeScript配置
├── tsconfig.server.json        # TypeScript配置 (后端)
└── .env.server                 # 后端环境变量
```

---

## 环境配置

### 前端环境配置

密钥由用户在页面输入，不需要配置环境变量。

### 后端环境配置

**.env.server**
```bash
# 服务器配置
PORT=5177
NODE_ENV=development

# AI模型配置（模型名称，不需要密钥）
MODELSCOPE_MODEL=deepseek-ai/DeepSeek-V3
EMBEDDING_MODEL=Qwen/Qwen3-Embedding-8B

# 数据配置
MOCK_DATA_ENABLED=true
AUTO_UPDATE_INTERVAL=30000
# 注意：API密钥由前端通过请求传递，不在此配置
```

---

## 核心功能实现

### 1. 智能健康对话

#### 对话流程

1. **用户输入**：支持文字输入和语音输入
2. **请求处理**：前端调用 `/api/chat/stream` 接口
3. **AI处理**：后端构建健康知识库提示词，使用DeepSeek-V3生成专业回答
4. **流式响应**：AI生成的内容通过SSE流式传输到前端
5. **数字人播报**：回复生成完成后，数字人自动播报健康建议

#### 系统提示词包含：
- 健康知识库信息
- 专业医疗知识
- 健康生活建议
- 常见疾病预防
- 营养健康指导

#### 快捷问题：
- 如何保持健康饮食？
- 每天应该运动多久？
- 怎样改善睡眠质量？
- 如何缓解工作压力？
- 感冒了应该注意什么？
- 健康生活方式有哪些？

### 2. 语音交互

#### 语音输入流程：
1. 用户点击麦克风按钮
2. 系统使用Web Speech API开始语音识别
3. 实时显示识别结果
4. 识别完成后自动发送问题

#### 语音播报流程：
1. AI生成健康建议后触发
2. 数字人使用魔珐星云SDK进行语音合成
3. 同步显示数字人动画
4. 播报完成后回到待机状态

### 3. 数字人服务

#### 连接流程：
1. 用户在配置页面输入魔珐星云密钥
2. 前端调用 `avatarController.connect()` 方法
3. SDK初始化并建立连接
4. 数字人进入待机状态

#### 播报控制：
- **自动播报**：健康咨询回复生成后自动触发
- **状态管理**：通过 `avatarStore` 管理数字人连接状态
- **错误处理**：连接失败时自动重试

### 4. 健康咨询系统

#### 核心功能：
- **专业健康建议**：基于AI的专业健康指导
- **实时对话**：流式生成，响应迅速
- **语音交互**：解放双手，便捷操作
- **数字人展示**：拟人化界面，提升用户体验

#### 技术实现：
- 使用魔搭AI DeepSeek-V3模型生成专业健康建议
- 集成Web Speech API实现语音识别
- 使用魔珐星云SDK实现3D数字人展示和语音合成
- 采用SSE流式传输技术实现实时对话

---

## API接口文档

### POST /api/chat/stream

**功能**：流式健康对话

**请求头**：
```
Content-Type: application/json
x-modelscope-api-key: {魔搭API密钥}
```

**请求体**：
```json
{
  "message": "如何保持健康饮食？",
  "conversationHistory": [
    {"role": "user", "content": "上一条消息"},
    {"role": "assistant", "content": "上一条回复"}
  ],
  "currentData": {}
}
```

**响应流**：
```
data: {"type":"content","data":"保持健康饮食的关键"}
data: {"type":"content","data":"是均衡营养"}
data: {"type":"content","data":"，包括适量的蛋白质"}
data: {"type":"content","data":"、碳水化合物"}
data: {"type":"content","data":"、脂肪"}
data: {"type":"content","data":"、维生素和矿物质"}
data: {"type":"end"}
```

---

## 开发注意事项

### 健康咨询准确性

- 系统提供的健康建议仅供参考，不能替代专业医疗建议
- 对于严重健康问题，应建议用户咨询专业医生
- 确保AI回复符合医疗伦理和专业标准

### AI配置

- 模型：`deepseek-ai/DeepSeek-V3`
- 超时时间：60秒（1分钟）
- 温度：0.7（健康咨询）
- 最大Token：1000（对话回复）

### 数字人SDK

- 需要有效的网络连接
- App ID和App Secret从星云控制台获取
- 支持手动连接/断开
- 数字人固定在屏幕中央20%区域

### 语音交互

- 语音识别功能推荐使用Chrome浏览器
- 确保在安静环境下使用语音输入
- 语音输入最长支持60秒

### 大屏适配

- 设计尺寸：1920x1080
- 使用scale缩放适配
- 响应式布局，支持不同屏幕尺寸

---

*文档版本: v1.2 | 最后更新: 2026-01-09*
